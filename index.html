<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Simulador Claro Up – V3.0 Final</title>
<style>
:root{
  --claro-red:#e60000; --claro-red-dark:#c80000;
  --bg:#f4f5f7; --card:#fff; --text:#111827; --muted:#64748b;
  --border:#e5e7eb; --radius:14px; --shadow:0 10px 30px rgba(0,0,0,0.08);
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text)}

/* Layout Global */
.topbar{background:var(--claro-red);color:#fff;padding:14px 16px;position:sticky;top:0;z-index:1000;box-shadow:0 4px 12px rgba(0,0,0,0.1)}
.topbar .row{max-width:1200px;margin:0 auto;display:flex;justify-content:space-between;align-items:center}
main{max-width:1200px;margin:20px auto;padding:0 16px;display:grid;grid-template-columns:1fr;gap:20px;}
@media(min-width:1024px){ main{grid-template-columns:1.05fr 0.95fr;} }

/* Accordion & Cards */
.sector-card{border-radius:var(--radius);border:1px solid var(--border);margin-bottom:16px;box-shadow:var(--shadow);overflow:hidden;background:#fff; transition: 0.3s;}
.sector-hd{padding:14px 16px;font-weight:800;font-size:13px;text-transform:uppercase;border-bottom:1px solid rgba(0,0,0,0.05); color: var(--claro-red-dark); cursor:pointer; display:flex; justify-content:space-between; align-items:center; background: #fff;}
.sector-hd:hover { background: #fdfdfd; }
.sector-hd .arrow { font-size: 12px; transition: transform 0.3s; color: var(--muted); }

/* Estados do Accordion */
.collapsed .sector-bd { display:none; }
.collapsed .arrow { transform: rotate(-90deg); }

.sector-bd{padding:16px}
.field-group{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px}
@media(max-width:600px){ .field-group{grid-template-columns:1fr} }
.field{display:flex;flex-direction:column;gap:4px;margin-bottom:10px}
label{font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase}
input, select, textarea{padding:10px;border:1px solid var(--border);border-radius:10px;font-size:15px;outline-color: var(--claro-red);}

/* Resultados Direita */
.res-container{background:#fff;border-radius:var(--radius);border:1px solid var(--border);box-shadow:var(--shadow);padding:16px; position: sticky; top: 80px;}
.res-title{font-weight:800;font-size:18px;margin-bottom:15px; color: var(--claro-red);}
.k-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:15px}
@media(max-width:500px){ .k-grid{grid-template-columns:1fr} }

.k-box{border:1px solid var(--border);border-radius:12px;padding:12px;background:#fff; min-height: 100px; display: flex; flex-direction: column; justify-content: space-between;}
.k-label{font-size:11px;font-weight:700;color:var(--muted);line-height:1.2;}
.k-val{font-size:19px;font-weight:900;color:#111827; margin: 5px 0;}
.red-repeat{color: var(--claro-red); font-weight: 800; font-size: 10px; text-transform: uppercase; margin-top: 4px; display: block; border-top: 1px solid #eee; padding-top: 4px;}

.eco-card{border:2px dashed var(--claro-red);border-radius:12px;padding:15px;margin-bottom:12px;background:#fff5f5; text-align: center;}
.eco-label{font-size:12px;font-weight:800;color:var(--claro-red-dark);margin-bottom:8px;display:block}
.eco-val{font-size:26px;font-weight:900;color:var(--claro-red);display:block}

/* Botões e Utilitários */
.btn-limpar{background:var(--muted);color:#fff;border:none;padding:8px 16px;border-radius:999px;font-weight:800;cursor:pointer;font-size:11px;}
.btn-whatsapp{background:#25d366;color:#fff;border:none;padding:14px 20px;border-radius:12px;font-weight:800;cursor:pointer;width:100%;font-size:15px; transition: 0.3s; box-shadow: 0 4px 10px rgba(37,211,102,0.3);}
.btn-whatsapp:hover { background: #1ebe57; transform: translateY(-2px); }

.acessorio-row{display:flex;gap:8px;margin-bottom:8px}
.btn-plus{background:var(--claro-red);color:#fff;border:none;border-radius:50%;width:26px;height:26px;cursor:pointer; font-weight: bold;}
</style>
</head>
<body>

<div class="topbar">
    <div class="row">
        <div class="brand"><strong>CLARO UP</strong> | Simulador V3.1</div>
        <div id="clock" style="font-weight: bold; opacity: 0.9;"></div>
    </div>
</div>

<main>
    <div class="inputs-column">
        <div class="header-actions">
            <h2 style="font-size:16px; margin:0">Configuração da Proposta</h2>
            <button class="btn-limpar" onclick="limparTudo()">Limpar Tudo</button>
        </div>

        <div class="sector-card">
            <div class="sector-hd" onclick="toggleCard(this)">1. Plano Atual do Cliente <span class="arrow">▼</span></div>
            <div class="sector-bd">
                <div class="field"><label>Plano atual do cliente (texto)</label><input id="planoAtualNome" type="text" placeholder="Ex: Claro Multi 50GB" oninput="recalc()"></div>
                <div class="field-group">
                    <div class="field"><label>Preço do plano (R$)</label><input id="planoAtualPreco" inputmode="decimal" oninput="recalc()"></div>
                    <div class="field"><label>Dependentes Pagos</label><input id="depPagos" type="number" oninput="recalc()"></div>
                    <div class="field"><label>Claro Clube (abatimento)</label><input id="claroClube" inputmode="decimal" oninput="recalc()"></div>
                    <div class="field"><label>Plano sugerido</label>
                        <select id="planoSugerido" onchange="recalc()">
                            <option value="">(sem seleção)</option>
                            <option value="219.90|2">Claro Multi Up 150GB — R$219,90</option>
                            <option value="319.90|3">Claro Multi Up 300GB — R$319,90</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="sector-card" id="cardTroca">
            <div class="sector-hd" onclick="toggleCard(this)">2. Troca Fone <span class="arrow">▼</span></div>
            <div class="sector-bd">
                <div class="field-group">
                    <div class="field"><label>Modelo do Aparelho Troca</label><input id="modeloTroca" type="text" oninput="recalc()"></div>
                    <div class="field"><label>Valor do Incentivo (R$)</label><input id="incentivoTroca" inputmode="decimal" oninput="recalc()"></div>
                </div>
            </div>
        </div>

        <div class="sector-card">
            <div class="sector-hd" onclick="toggleCard(this)">3. Valores Claro Up <span class="arrow">▼</span></div>
            <div class="sector-bd">
                <div class="field"><label>Modelo iPhone Ofertado</label>
                    <select id="modeloOferta" onchange="recalc()">
                        <option value="">Selecione...</option>
                        <option>iPhone 16 128GB</option><option>iPhone 16 Pro 128GB</option>
                        <option>iPhone 17 256GB</option><option>iPhone 17 Pro 256GB</option>
                        <option>iPhone 17 Pro Max 256GB</option>
                    </select>
                </div>
                <div class="field-group">
                    <div class="field"><label>Preço Full (R$)</label><input id="prePagoTotal" inputmode="decimal" oninput="recalc()"></div>
                    <div class="field"><label>Valor no Multi (R$)</label><input id="multiTotal" inputmode="decimal" oninput="recalc()"></div>
                    <div class="field"><label>Valor Claro Up (R$)</label><input id="claroUpTotal" inputmode="decimal" oninput="recalc()"></div>
                    <div class="field"><label>Valor Residual (R$)</label><input id="residual" inputmode="decimal" oninput="recalc()"></div>
                </div>
                <div class="field"><label>Parcelas</label><select id="parcelasSel" onchange="recalc()"><option value="21">21x</option><option value="12">12x</option></select></div>
            </div>
        </div>

        <div class="sector-card" id="cardOpcao">
            <div class="sector-hd" onclick="toggleCard(this); toggleResultCards()">4. Outra opção de aparelho no plano atual <span class="arrow">▼</span></div>
            <div class="sector-bd">
                <div class="field-group">
                    <div class="field"><label>Aparelho interesse (nome)</label><input id="modeloInteresse" type="text" oninput="recalc()"></div>
                    <div class="field"><label>Total Aparelho (R$)</label><input id="totalInteresse" inputmode="decimal" oninput="recalc()"></div>
                </div>
            </div>
        </div>

        <div class="sector-card">
            <div class="sector-hd" onclick="toggleCard(this)">5. Acessórios <span class="arrow">▼</span></div>
            <div class="sector-bd">
                <div id="acessoriosContainer"><div class="acessorio-row"><input type="text" placeholder="Item" class="ace-nome" style="flex:1"><input type="number" placeholder="R$" class="ace-preco" style="width:80px" oninput="recalc()"><button class="btn-plus" onclick="addAcessorio()">+</button></div></div>
                <div style="margin-top:10px; border-top:1px solid #eee; padding-top: 8px; font-weight:800; font-size:12px; display: flex; justify-content: space-between;">
                    <span>TOTAL: <span id="totalAcessorios">R$ 0,00</span></span>
                    <span style="color: var(--claro-red);">PARCELA: <span id="aceParcelaValor">R$ 0,00</span></span>
                </div>
            </div>
        </div>
    </div>

    <div class="results-column">
        <div class="res-container">
            <div class="res-title">Resumo Comparativo</div>
            <div class="k-grid">
                <div class="k-box"><span class="k-label">Custo Mensal Plano Atual</span><div class="k-val" id="outPlanoMensalAtual">R$ 0,00</div><span class="red-repeat rep-atual"></span></div>
                <div class="k-box"><span class="k-label">Custo Mensal Plano Sugerido</span><div class="k-val" id="outPlanoSugerido">R$ 0,00</div><span class="red-repeat rep-sug"></span></div>
                
                <div class="k-box"><span class="k-label">Parcela Multi (+ Seguro)</span><div class="k-val" id="outMultiParc">R$ 0,00</div><span class="red-repeat rep-atual"></span></div>
                <div class="k-box" style="border-color: var(--claro-red);"><span class="k-label" style="color: var(--claro-red);">Parcela Claro Up</span><div class="k-val" id="outUpParc">R$ 0,00</div><span class="red-repeat rep-sug"></span></div>
                
                <div class="k-box" style="background: #f0fff4; border-color: #25d366;"><span class="k-label">Parcela Up + Troca</span><div class="k-val" id="outUpTrocaParc" style="color: #1a7f37;">R$ 0,00</div><span class="red-repeat rep-sug"></span></div>
                
                <div class="k-box res-opcional"><span class="k-label">Aparelho Interesse Total</span><div class="k-val" id="outInteresseTotal">R$ 0,00</div><span class="red-repeat rep-atual"></span></div>
                <div class="k-box res-opcional"><span class="k-label">Parcela no Plano Atual</span><div class="k-val" id="outInteresseParc">R$ 0,00</div><span class="red-repeat rep-atual"></span></div>
            </div>
            
            <div class="eco-card"><span class="eco-label">Economia no Aparelho (Up vs Multi)</span><span class="eco-val" id="outEcoTotalSem">R$ 0,00</span></div>
            <div class="k-box"><span class="k-label">Residual (Mês 22)</span><div class="k-val" id="outResidual">R$ 0,00</div></div>

            <button class="btn-whatsapp" onclick="copiar()">Copiar Resumo (WhatsApp)</button>
            <div class="field" style="margin-top:15px"><label>Observações da Proposta</label><textarea id="obs" rows="3" placeholder="Digite detalhes extras aqui..."></textarea></div>
            <div id="msgValidade" style="font-size:10px; color:var(--muted); text-align:center; margin-top:15px; font-weight: bold;"></div>
        </div>
    </div>
</main>

<script>
const $ = (id) => document.getElementById(id);
const brl = (v) => Number(v).toLocaleString("pt-BR", { style:"currency", currency:"BRL" });

function toggleCard(el) { el.parentElement.classList.toggle('collapsed'); }

function toggleResultCards() {
    const isCollapsed = $("cardOpcao").classList.contains('collapsed');
    document.querySelectorAll('.res-opcional').forEach(c => c.style.display = isCollapsed ? 'none' : 'flex');
}

function addAcessorio() {
    const div = document.createElement("div"); div.className = "acessorio-row";
    div.innerHTML = `<input type="text" class="ace-nome" style="flex:1"><input type="number" class="ace-preco" style="width:80px" oninput="recalc()"><button class="btn-plus" style="background:#64748b" onclick="this.parentElement.remove(); recalc()">-</button>`;
    $("acessoriosContainer").appendChild(div);
}

function parseVal(id) { 
    let val = $(id).value.replace(/\./g, '').replace(',', '.'); 
    return parseFloat(val) || 0; 
}

function recalc() {
    const nomeAtual = $("planoAtualNome").value || "Plano não informado";
    const planoSel = $("planoSugerido");
    const nomeSugerido = planoSel.options[planoSel.selectedIndex].text.split(' — ')[0];

    // Atualizar repetições em vermelho
    document.querySelectorAll('.rep-atual').forEach(el => el.textContent = nomeAtual);
    document.querySelectorAll('.rep-sug').forEach(el => el.textContent = (nomeSugerido === "(sem seleção)") ? "" : nomeSugerido);

    const parcelas = parseInt($("parcelasSel").value);
    const clube = parseVal("claroClube");
    
    // Cálculo do Plano Atual
    const precoPlanoAtu = parseVal("planoAtualPreco");
    const totalPlanoAtu = precoPlanoAtu + (parseVal("depPagos") * 50);
    $("outPlanoMensalAtual").textContent = brl(totalPlanoAtu);
    
    // Cálculo do Plano Sugerido
    const sugData = $("planoSugerido").value.split("|");
    if(sugData.length === 2) $("outPlanoSugerido").textContent = brl(parseFloat(sugData[0]));

    // Cálculos de Aparelho
    const multiBase = Math.max(0, parseVal("multiTotal") - clube);
    const upBase = Math.max(0, parseVal("claroUpTotal") - clube);
    const incentivo = parseVal("incentivoTroca");
    const intTotal = Math.max(0, parseVal("totalInteresse") - clube);

    $("outMultiParc").textContent = brl((multiBase / parcelas) + (multiBase > 0 ? 60 : 0));
    $("outUpParc").textContent = brl(upBase / parcelas);
    $("outUpTrocaParc").textContent = brl(Math.max(0, upBase - incentivo) / parcelas);
    
    $("outInteresseTotal").textContent = brl(intTotal);
    $("outInteresseParc").textContent = brl(intTotal / parcelas);

    // Economia e Residual
    $("outEcoTotalSem").textContent = brl((multiBase + (60 * parcelas)) - upBase);
    $("outResidual").textContent = brl(parseVal("residual"));

    // Acessórios
    let tA = 0; 
    document.querySelectorAll(".ace-preco").forEach(el => tA += parseFloat(el.value) || 0);
    $("totalAcessorios").textContent = brl(tA);
    $("aceParcelaValor").textContent = brl(tA / parcelas);

    const n = new Date(); 
    $("msgValidade").textContent = `Esta simulação é válida apenas para a data: ${n.toLocaleDateString()} às ${n.toLocaleTimeString()}`;
}

function copiar() {
    const n = new Date();
    const dataHora = `${n.toLocaleDateString()} às ${n.toLocaleTimeString()}`;
    const planoSel = $("planoSugerido");
    const nomeSug = planoSel.options[planoSel.selectedIndex].text;
    
    let acessoriosTxt = "";
    let tA = 0;
    document.querySelectorAll(".acessorio-row").forEach(row => {
        const nome = row.querySelector(".ace-nome").value;
        const preco = parseFloat(row.querySelector(".ace-preco").value) || 0;
        if(nome) { acessoriosTxt += `   • ${nome}: ${brl(preco)}\n`; tA += preco; }
    });

    let txt = `*OFERTA PERSONALIZADA CLARO UP*\n\n`;
    txt += `1️⃣ *PLANO SUGERIDO:* \n${nomeSug}\n\n`;
    
    const troca = $("modeloTroca").value;
    txt += `2️⃣ *TROCA FONE:* \n${troca ? `Aparelho: ${troca} (-${brl(parseVal("incentivoTroca"))})` : 'Não aplicado'}\n\n`;

    txt += `3️⃣ *APARELHO:* \n${$("modeloOferta").value || 'Não selecionado'} \nPreço Cheio: ${brl(parseVal("prePagoTotal"))}\n\n`;
    txt += `4️⃣ *PARCELAMENTO:* \n*${$("parcelasSel").value}x de ${$("outUpParc").textContent}*\n\n`;
    txt += `5️⃣ *VALOR RESIDUAL:* \n${brl(parseVal("residual"))} (Mês 22)\n\n`;

    if(tA > 0) {
        txt += `6️⃣ *ACESSÓRIOS:*\n${acessoriosTxt}`;
        txt += `Total: ${brl(tA)} (${$("parcelasSel").value}x de ${$("aceParcelaValor").textContent})\n\n`;
    } else {
        txt += `6️⃣ *ACESSÓRIOS:* Não inclusos\n\n`;
    }

    txt += `7️⃣ *OBSERVAÇÕES:* \n${$("obs").value || 'Nenhuma'}\n\n`;
    txt += `8️⃣ _Simulação válida para ${dataHora}_`;

    navigator.clipboard.writeText(txt).then(() => alert("Resumo pronto para colar no WhatsApp!"));
}

function limparTudo() { if(confirm("Limpar todos os campos?")) location.reload(); }

setInterval(() => { $("clock").textContent = new Date().toLocaleTimeString(); }, 1000);
window.onload = recalc;
</script>
</body>
</html>